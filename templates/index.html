<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ define "title" }}Camberry{{ end }}</title>
  <style>
    #remoteVideo {
      background: #222;
      height: 720px;
      width: 1280px;
    }
  </style>
</head>
<body>
  <h1>Camberry</h1>
  <video id="remoteVideo" autoplay></video>
  <script src="/static/js/adapter-latest.js"></script>
  <script>
    // Create a websocket connection for exchanging SDP data
    const ws = new WebSocket("ws://localhost:8000/ws");

    ws.addEventListener("message", function (event) {
      console.log("websocket received:", event.data);
    });

    ws.addEventListener("open", function (event) {
      console.log("websocket opened");
      // Create WebRTC peer-to-peer connection
      var pc = new RTCPeerConnection({ iceCandidatePoolSize: 10 });

      // register ICE candidate handler
      pc.onicecandidate = function(event) {
        if (event.candidate) {
          console.log("onicecandidate:", event.candidate);
          ws.send(JSON.stringify(event.candidate));
        } else {
          console.log("all sent");
        }
      }

      // Create offer
      pc.createOffer({ offerToReceiveAudio: true, offerToReceiveVideo: true })
      .then(function(desc) {
        console.log("createOffer success:", desc.sdp);
        pc.setLocalDescription(desc);
        ws.send(desc.sdp);
      })
      .catch(function(error) {
        console.log("createOffer failure:", error);
      });
    });
  </script>
</body>
</html>
